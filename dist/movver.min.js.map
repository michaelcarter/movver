{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/movver.js"],"names":[],"mappings":"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","file":"movver.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","var Movver = (function() {\n\n  Movver.prototype.watchedElements = [];\n  Movver.prototype.touchStartOffsets = [];\n  Movver.prototype.touchEndOffsets = [];\n  Movver.prototype.elementTimeouts = [];\n  Movver.prototype.viewableLowerBoundary = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n  Movver.prototype.pollScrollCount = 0;\n  Movver.prototype.MAX_TOUCH_OFFSETS = 2;\n  Movver.prototype.FOCUS_PERCENTAGE_THRESHOLD = 70;\n  Movver.prototype.DEBUG = false;\n  Movver.prototype.EVENT_TIMEOUT = 1000;\n  Movver.prototype.MOBILE_THRESHOLD = 490;\n\n  function Movver(opts) {\n    if (!opts) opts = {};\n    if (opts.touchAverage) this.MAX_TOUCH_OFFSETS = opts.touchAverage;\n    if (opts.focusThreshold) this.FOCUS_PERCENTAGE_THRESHOLD = opts.focusThreshold;\n    if (opts.eventTimeout) this.EVENT_TIMEOUT = opts.eventTimeout;\n    if (opts.mobileThreshold) this.MOBILE_THRESHOLD = opts.mobileThreshold;\n    if (!!opts.debug) this.DEBUG = true;\n\n    if (this.DEBUG) {\n      document.body.innerHTML += '<div id=\"thumbArea\" style=\"background:rgba(255,0,0,0.5); position:fixed; width:100%; z-index:1;\"></div>';\n    }\n\n    this._addListeners();\n  }\n\n  Movver.prototype.watch = function(element) {\n    if (typeof element !== \"object\") throw new Error(\"Element must be an object.\");\n    this.watchedElements.push(element);\n  }\n\n  Movver.prototype.unwatch = function(element) {\n    if (typeof element !== \"object\") throw new Error(\"Element must be an object.\");\n    var indexOfElement = this.watchedElements.indexOf(element);\n    if (indexOfElement > -1) {\n      this.watchedElements.splice(indexOfElement, 1);\n      return true\n    }\n    return false;\n  }\n\n  // PRIVATE FUNCTIONS\n  // ================= //\n  Movver.prototype._arrayAverage = function(arrayOfIntegers) {\n    var sum = arrayOfIntegers.reduce(function(a, b) { return a + b });\n    return sum / arrayOfIntegers.length;\n  }\n\n  Movver.prototype._calculateFocusPercentage = function(element) {\n    var elementBoundingClientRect = element.getBoundingClientRect();\n    var elementMidPoint = (elementBoundingClientRect.top + elementBoundingClientRect.bottom) / 2\n    var result = (elementMidPoint / (this.viewableLowerBoundary/2)) * 100;\n    if (result > 100) result = 200-result;\n    return (result < 0) ? 0 : result;\n  }\n\n  Movver.prototype._findElementTimeout = function(element) {\n    for (var i = 0; i < this.elementTimeouts.length; i++) {\n      if (element === this.elementTimeouts[i].element) {\n        return this.elementTimeouts[i];\n      }\n    }\n    return null;\n  } \n\n  Movver.prototype._elementTimeoutExists = function(element) {\n    return !!this._findElementTimeout(element);\n  }\n\n  Movver.prototype._clearElementTimeout = function(element) {\n    var elementTimeout = this._findElementTimeout(element);\n    var indexOfElementTimeout = this.elementTimeouts.indexOf(elementTimeout);\n\n    if (elementTimeout) {\n      window.clearTimeout(elementTimeout.timeout);\n    }\n\n    if (indexOfElementTimeout > -1) {\n      this.elementTimeouts.splice(indexOfElementTimeout,1);\n    }\n\n    return !!elementTimeout;\n  }\n\n  Movver.prototype._onMobile = function() {\n    return (Math.max(document.documentElement.clientWidth, window.innerWidth || 0) / window.devicePixelRatio <= this.MOBILE_THRESHOLD)\n  }\n\n  Movver.prototype._scrollOffset = function() {\n    if (self.pageYOffset) {\n      return self.pageYOffset;\n    } else if (document.documentElement && document.documentElement.scrollTop) {\n      return document.documentElement.scrollTop;\n    } else if (document.body) {\n      return document.body.scrollTop;\n    }\n  }\n\n  Movver.prototype._clearPollForScrolling = function() {\n    console.log(\"Clearing poll!\")\n    this.pollScrollCount = 0;\n    this.lastScrollOffset = -1;\n    window.clearInterval(this.scrollPoller);\n    this.scrollPoller = false;\n  }\n\n  Movver.prototype._checkForScroll = function() {\n    this.pollScrollCount += 1;\n    var scrollOffset = this._scrollOffset();\n\n    if (this.lastScrollOffset === scrollOffset || this.pollScrollCount >= 50) {\n      this._clearPollForScrolling();\n    } else {\n      this._checkWatchedElementsFocus();\n      this.lastScrollOffset = scrollOffset;\n      this.pollScrollCount += 1;\n    }\n  }\n\n  Movver.prototype._pollForScrolling = function() {\n    if (this.scrollPoller) {\n      this._clearPollForScrolling();\n    }\n    this.scrollPoller = window.setInterval(this._checkForScroll.bind(this), 100);\n  }\n\n  Movver.prototype._checkWatchedElementsFocus = function() {\n    var self = this;\n    // Trigger the event on any focussed elements.\n    this.watchedElements.forEach(function(element, index) {\n      var focusPercentage = self._calculateFocusPercentage(element);\n      var elementTimeoutExists = self._elementTimeoutExists(element);\n      if ((focusPercentage >= self.FOCUS_PERCENTAGE_THRESHOLD) && !elementTimeoutExists) {\n\n        // Push a timeout to trigger the event onto the stack\n        self.elementTimeouts.push({\n          element: element,\n          timeout: window.setTimeout(function() {\n            element.dispatchEvent(new Event('movver'));\n          }, self.EVENT_TIMEOUT)\n        });\n      } else if ((focusPercentage < self.FOCUS_PERCENTAGE_THRESHOLD) && elementTimeoutExists) {\n        self._clearElementTimeout(element);\n      }\n\n      // Show the focus of the element visually.\n      if (self.DEBUG) {\n        self._fillRect(element, focusPercentage);\n      }\n    });\n  }\n\n  // DEBUG only functions, for highlighting what's focussed on the page.\n  // =================================================================== //\n  Movver.prototype._fillRect = function(element, focusPercentage) {\n    var brightness = (255/100) * focusPercentage;\n    element.style.backgroundColor = 'rgb(0,'+Math.round(brightness)+',0)';\n  }\n\n  Movver.prototype._setVisibleBounds = function() {\n    var el = document.getElementById(\"thumbArea\");\n    el.style.top = this.viewableLowerBoundary+\"px\";\n    el.style.height = (document.documentElement.clientHeight - this.viewableLowerBoundary + 100) + \"px\";\n  }\n\n  // Document listeners\n  // ================== //\n  Movver.prototype._onTouchStart = function(e) {\n    if (!this._onMobile()) return;\n    this.touchStartOffsets.push(e.touches[0].pageY - e.view.scrollY);\n    if (this.touchStartOffsets.length > this.MAX_TOUCH_OFFSETS) this.touchStartOffsets.shift();\n    this._pollForScrolling();\n  }\n\n  Movver.prototype._onTouchEnd = function(e) {\n    if (!this._onMobile()) return;\n    this.touchEndOffsets.push(e.changedTouches[0].pageY - e.view.scrollY);\n    if (this.touchEndOffsets.length > this.MAX_TOUCH_OFFSETS) this.touchEndOffsets.shift();\n    this.viewableLowerBoundary = Math.min(Math.round(this._arrayAverage(this.touchEndOffsets)), Math.round(this._arrayAverage(this.touchStartOffsets)));\n    if (this.DEBUG) this._setVisibleBounds();\n  }\n\n  Movver.prototype._addListeners = function() {\n    var self = this;\n\n    document.addEventListener('touchstart', this._onTouchStart.bind(this));\n    document.addEventListener('touchend', this._onTouchEnd.bind(this));\n  }\n\n  return Movver;\n})();\n\nif (typeof window.define === \"function\" && window.define.amd) {\n  window.define('movver', [], function() {\n    return Movver;\n  });\n}"],"sourceRoot":"/source/"}